<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åç‰‡è¨­å®šå¾Œå° | Admin Console</title>
    <style>
        /* å•†æ¥­ç´š UI è¨­è¨ˆè¦ç¯„ */
        :root {
            --bg-light: #f8f9fa;
            --bg-dark: #1e1e1e;
            --border: #dee2e6;
            --primary: #0d6efd;
            --primary-hover: #0b5ed7;
            --text-main: #212529;
            --code-text: #a5d6a7;
        }

        body { display: flex; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; height: 100vh; margin: 0; color: var(--text-main); }
        
        /* å·¦å³åˆ†å‰²ä½ˆå±€ */
        .panel { flex: 1; padding: 30px; overflow-y: auto; box-sizing: border-box; }
        .left { background: var(--bg-light); border-right: 1px solid var(--border); }
        .right { background: var(--bg-dark); color: #f8f9fa; position: relative; display: flex; flex-direction: column; }

        /* è¡¨å–®æ¨£å¼ */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #495057; font-size: 0.9rem; }
        input, textarea { width: 100%; padding: 10px 12px; border: 1px solid #ced4da; border-radius: 6px; box-sizing: border-box; font-size: 14px; transition: 0.2s; }
        input:focus, textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.15); }

        /* è®€å–å€å¡Š (Load Section) */
        .load-section { background: #e2e6ea; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #dbe2e8; }
        .load-row { display: flex; gap: 10px; }
        .load-row input { flex: 1; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 14px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-copy { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
        .btn-copy:hover { background: rgba(255,255,255,0.2); }

        /* ç¨‹å¼ç¢¼é è¦½å€ */
        pre { font-family: "SFMono-Regular", Consolas, "Liberation Mono", monospace; white-space: pre-wrap; color: var(--code-text); margin: 0; flex: 1; font-size: 14px; line-height: 1.5; }
        h2 { margin-top: 0; border-bottom: 2px solid #dee2e6; padding-bottom: 15px; margin-bottom: 20px; }
        .section-title { font-size: 0.85rem; text-transform: uppercase; color: #6c757d; font-weight: 700; margin: 25px 0 15px 0; letter-spacing: 0.5px; }
        
        #status-msg { margin-top: 10px; font-size: 0.85rem; height: 1.2em; }
        .success { color: #198754; }
        .error { color: #dc3545; }
    </style>
</head>
<body>

    <div class="panel left">
        
        <div class="load-section">
            <label>ğŸ“¡ æ­¥é©Ÿ 1ï¼šè¼‰å…¥é›²ç«¯è³‡æ–™</label>
            <div class="load-row">
                <input type="text" id="load-id" placeholder="è¼¸å…¥ User ID (ä¾‹å¦‚: jasper)">
                <button class="btn btn-primary" onclick="loadUserData()">è®€å– Config</button>
            </div>
            <div id="status-msg"></div>
        </div>

        <h2>âœï¸ æ­¥é©Ÿ 2ï¼šç·¨è¼¯å…§å®¹</h2>
        
        <div class="section-title">åŸºæœ¬è³‡æ–™ (Profile Info)</div>
        <div class="form-group">
            <label>å§“å (Name)</label>
            <input type="text" id="inp-name" placeholder="æ‚¨çš„åå­—" oninput="generate()">
        </div>
        <div class="form-group">
            <label>è·ç¨± (Title)</label>
            <input type="text" id="inp-title" placeholder="æ‚¨çš„è·ç¨±" oninput="generate()">
        </div>
        <div class="form-group">
            <label>ç°¡ä»‹ (Bio)</label>
            <textarea id="inp-bio" rows="3" placeholder="ä¸€å¥è©±ä»‹ç´¹è‡ªå·±..." oninput="generate()"></textarea>
        </div>

        <div class="section-title">ç¤¾ç¾¤é€£çµ (Links)</div>
        <div class="form-group">
            <label>Instagram</label>
            <input type="text" id="inp-instagram" class="link-input" data-key="instagram" oninput="generate()">
        </div>
        <div class="form-group">
            <label>LinkedIn</label>
            <input type="text" id="inp-linkedin" class="link-input" data-key="linkedin" oninput="generate()">
        </div>
        <div class="form-group">
            <label>GitHub</label>
            <input type="text" id="inp-github" class="link-input" data-key="github" oninput="generate()">
        </div>
        <div class="form-group">
            <label>Email (mailto:)</label>
            <input type="text" id="inp-email" class="link-input" data-key="email" placeholder="mailto:user@example.com" oninput="generate()">
        </div>
        <div class="form-group">
            <label>Website</label>
            <input type="text" id="inp-website" class="link-input" data-key="website" oninput="generate()">
        </div>
    </div>

    <div class="panel right">
        <h2 style="border-color: #495057; font-size: 1.2rem;">ğŸ“‹ æ­¥é©Ÿ 3ï¼šè¤‡è£½ç¨‹å¼ç¢¼</h2>
        <button class="btn btn-copy" onclick="copyCode()">è¤‡è£½ä»£ç¢¼ (Copy)</button>
        <pre><code id="output-code">// è«‹å…ˆåœ¨å·¦å´è¼¸å…¥è³‡æ–™...</code></pre>
    </div>

    <script>
        // ==========================================
        // âš ï¸ è«‹ä¿®æ”¹æ­¤è™•ä»¥ç¬¦åˆæ‚¨çš„ GitHub Repo è¨­å®š
        // ==========================================
        const GITHUB_USERNAME = "ä½ çš„GitHubå¸³è™Ÿ"; // ä¾‹å¦‚: Jasper-Chen
        const REPO_NAME = "ä½ çš„Repoåç¨±";         // ä¾‹å¦‚: digital-card
        // ==========================================

        // 1. è®€å–è³‡æ–™é‚è¼¯ (Fetch)
        async function loadUserData() {
            const userId = document.getElementById('load-id').value.trim();
            const statusEl = document.getElementById('status-msg');

            if (!userId) {
                showStatus("è«‹è¼¸å…¥ ID", "error");
                return;
            }

            showStatus("æ­£åœ¨å¾ GitHub è®€å–...", "normal");

            // å»ºæ§‹ Raw Data URL (åŠ å…¥æ™‚é–“æˆ³è¨˜é˜²æ­¢å¿«å–)
            const url = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/u/${userId}/config.js?t=${Date.now()}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("æ‰¾ä¸åˆ°æ­¤ä½¿ç”¨è€…çš„è¨­å®šæª” (404)");

                const text = await response.text();
                parseAndHydrate(text);
                showStatus("âœ… è®€å–æˆåŠŸï¼è³‡æ–™å·²å¡«å…¥è¡¨å–®", "success");
            } catch (error) {
                console.error(error);
                showStatus("âŒ è®€å–å¤±æ•—ï¼šå¯èƒ½æ˜¯ ID éŒ¯èª¤æˆ–è©²ä½¿ç”¨è€…å°šæœªå»ºç«‹è³‡æ–™ã€‚", "error");
            }
        }

        // 2. è§£æä¸¦å¡«å…¥è¡¨å–® (Hydration)
        function parseAndHydrate(jsContent) {
            try {
                // å¾ JS æª”æ¡ˆä¸­æå– JSON ç‰©ä»¶å­—ä¸² (å°‹æ‰¾ç¬¬ä¸€å€‹ { å’Œæœ€å¾Œä¸€å€‹ })
                const jsonStart = jsContent.indexOf('{');
                const jsonEnd = jsContent.lastIndexOf('}');
                
                if (jsonStart === -1 || jsonEnd === -1) throw new Error("æ ¼å¼è§£æéŒ¯èª¤");

                const jsonStr = jsContent.substring(jsonStart, jsonEnd + 1);
                // æ³¨æ„ï¼šé€™è£¡å‡è¨­ config.js æ ¼å¼æ˜¯æ¨™æº– JSON çµæ§‹ï¼Œå¦‚æœå«æœ‰ JS è¨»è§£å¯èƒ½æœƒè§£æå¤±æ•—
                // å¯¦å‹™ä¸Šå»ºè­° config.js ä¿æŒç´”æ·¨
                
                // ä½¿ç”¨ Function å»ºæ§‹å­ä¾†å®‰å…¨è§£æ (å› ç‚ºå®ƒå¯èƒ½åŒ…å«å¯¬é¬†çš„ JS èªæ³•)
                // æˆ–è€…åš´æ ¼è¦æ±‚ config.js å¿…é ˆæ˜¯æ¨™æº– JSON æ ¼å¼
                // é€™è£¡ç¤ºç¯„è¼ƒå¯¬é¬†çš„è§£ææ³•ï¼š
                const profile = (new Function("return " + jsonStr))();

                // å¡«å…¥æ¬„ä½
                if (profile.info) {
                    setVal('inp-name', profile.info.name);
                    setVal('inp-title', profile.info.title);
                    setVal('inp-bio', profile.info.bio);
                }

                if (profile.links) {
                    document.querySelectorAll('.link-input').forEach(input => {
                        const key = input.dataset.key;
                        if (profile.links[key]) {
                            input.value = profile.links[key];
                        } else {
                            input.value = "";
                        }
                    });
                }
                
                // é‡æ–°ç”Ÿæˆé è¦½
                generate();

            } catch (e) {
                console.error(e);
                showStatus("âš ï¸ è³‡æ–™è§£æéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ config.js æ ¼å¼", "error");
            }
        }

        // 3. ç”Ÿæˆä»£ç¢¼é‚è¼¯ (Generate)
        function generate() {
            // æ”¶é›†åŸºæœ¬è³‡æ–™
            const name = document.getElementById('inp-name').value;
            const title = document.getElementById('inp-title').value;
            const bio = document.getElementById('inp-bio').value;

            // æ”¶é›†é€£çµè³‡æ–™
            const links = {};
            document.querySelectorAll('.link-input').forEach(input => {
                // å³ä½¿æ˜¯ç©ºå­—ä¸²ä¹Ÿè¦ä¿ç•™ keyï¼Œç¶­æŒçµæ§‹å®Œæ•´æ€§
                links[input.dataset.key] = input.value.trim();
            });

            // çµ„è£ç‰©ä»¶
            const profile = {
                info: {
                    name: name,
                    title: title,
                    avatar: `https://github.com/${GITHUB_USERNAME}.png`, // è‡ªå‹•ä½¿ç”¨ GitHub é ­åƒ
                    bio: bio
                },
                theme: {
                    primaryColor: "#000000"
                },
                links: links
            };

            // è½‰æˆæ ¼å¼åŒ–çš„ JS ä»£ç¢¼
            const code = `const USER_PROFILE = ${JSON.stringify(profile, null, 4)};`;
            
            // é¡¯ç¤ºåœ¨å³å´
            document.getElementById('output-code').textContent = code;
        }

        // 4. è¤‡è£½åŠŸèƒ½
        function copyCode() {
            const code = document.getElementById('output-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelector('.btn-copy');
                const originalText = btn.textContent;
                btn.textContent = "å·²è¤‡è£½ï¼(Copied)";
                btn.style.background = "#198754";
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = "";
                }, 2000);
            });
        }

        // å·¥å…·å‡½å¼
        function setVal(id, val) {
            const el = document.getElementById(id);
            if(el) el.value = val || "";
        }

        function showStatus(msg, type) {
            const el = document.getElementById('status-msg');
            el.textContent = msg;
            el.className = type;
            if(type === 'normal') el.style.color = '#6c757d';
        }

        // åˆå§‹åŒ–
        generate();
    </script>
</body>
</html>
